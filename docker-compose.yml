services:
  jupyterhub:
    build: .
    restart: unless-stopped

    environment:
      # Put these in Coolify "Environment Variables / Secrets" ideally
      JUPYTERHUB_CRYPT_KEY: ${JUPYTERHUB_CRYPT_KEY}
      JHUB_DUMMY_PASSWORD: ${JHUB_DUMMY_PASSWORD}

    volumes:
      # Hub state (db, cookies, etc.)
      - jupyterhub_data:/data

      # Hub config
      - ./jupyterhub_config.py:/srv/jupyterhub/jupyterhub_config.py:ro

      # Required for DockerSpawner (Hub spawns user containers)
      - /var/run/docker.sock:/var/run/docker.sock

    command: >
      bash -lc "jupyterhub -f /srv/jupyterhub/jupyterhub_config.py"

volumes:
  jupyterhub_data:
